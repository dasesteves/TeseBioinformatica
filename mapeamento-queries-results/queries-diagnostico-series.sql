-- =====================================================
-- QUERIES DE DIAGNÓSTICO - DESCOBRIR O PROBLEMA
-- =====================================================

-- 1. VERIFICAR SE HÁ REGISTOS NA TABELA
SELECT COUNT(*) AS TOTAL_REGISTOS 
FROM PCE.CSU_EPENTIDADEACTOS;

-- 2. VERIFICAR SE OS CAMPOS DE SÉRIE/TIPO ESTÃO PREENCHIDOS
SELECT 
    COUNT(*) AS TOTAL,
    COUNT(CDU_CSU_TIPODOCSTK) AS COM_TIPO_DOC,
    COUNT(CDU_CSU_SERIESTK) AS COM_SERIE,
    COUNT(CDU_CSU_NUMDOCSTK) AS COM_NUM_DOC
FROM PCE.CSU_EPENTIDADEACTOS;

-- 3. VER ALGUNS REGISTOS RECENTES (SEM FILTROS)
SELECT * FROM (
    SELECT 
        CDU_CSU_ID,
        EPISODIO,
        CDU_CSU_TIPODOCSTK,
        CDU_CSU_SERIESTK,
        CDU_CSU_NUMDOCSTK,
        CDU_CSU_FILIALSTK,
        TO_CHAR(CDU_CSU_DATA, 'DD/MM/YYYY') AS DATA
    FROM PCE.CSU_EPENTIDADEACTOS
    ORDER BY CDU_CSU_DATA DESC
) t WHERE ROWNUM <= 10;

-- 4. VERIFICAR SE O ARTIGO FA10040790 EXISTE
SELECT COUNT(*) AS TOTAL_FA10040790
FROM PCE.CSU_EPENTIDADEACTOGASTOS
WHERE CDU_CSU_ARTIGO = 'FA10040790';

-- 5. VER TODOS OS ARTIGOS COM PREFIXO FA
SELECT * FROM (
    SELECT DISTINCT CDU_CSU_ARTIGO
    FROM PCE.CSU_EPENTIDADEACTOGASTOS
    WHERE CDU_CSU_ARTIGO LIKE 'FA%'
    ORDER BY CDU_CSU_ARTIGO
) t WHERE ROWNUM <= 20;

-- 6. VERIFICAR VALORES DISTINTOS DE CDU_CSU_EXPORTADO
SELECT 
    CDU_CSU_EXPORTADO,
    COUNT(*) AS TOTAL
FROM PCE.CSU_EPENTIDADEACTOS
GROUP BY CDU_CSU_EXPORTADO
ORDER BY CDU_CSU_EXPORTADO;

-- 7. BUSCAR QUALQUER MOVIMENTO COM SÉRIE PREENCHIDA
SELECT * FROM (
    SELECT 
        CDU_CSU_TIPODOCSTK,
        CDU_CSU_SERIESTK,
        CDU_CSU_FILIALSTK,
        CDU_CSU_NUMDOCSTK,
        TO_CHAR(CDU_CSU_DATA, 'DD/MM/YYYY') AS DATA
    FROM PCE.CSU_EPENTIDADEACTOS
    WHERE CDU_CSU_SERIESTK IS NOT NULL
       OR CDU_CSU_TIPODOCSTK IS NOT NULL
    ORDER BY CDU_CSU_DATA DESC
) t WHERE ROWNUM <= 20;

-- 8. VERIFICAR SE É PROBLEMA DE MAIÚSCULAS/MINÚSCULAS
SELECT * FROM (
    SELECT DISTINCT 
        CDU_CSU_ARTIGO,
        LENGTH(CDU_CSU_ARTIGO) AS TAMANHO
    FROM PCE.CSU_EPENTIDADEACTOGASTOS
    WHERE UPPER(CDU_CSU_ARTIGO) LIKE '%FA10040790%'
       OR CDU_CSU_ARTIGO LIKE '%10040790%'
) t WHERE ROWNUM <= 10;

-- 9. VER ESTRUTURA DOS DADOS MAIS RECENTES
SELECT * FROM (
    SELECT 
        ea.CDU_CSU_ID,
        ea.EPISODIO,
        ea.CDU_CSU_ACTOID,
        eg.CDU_CSU_ARTIGO,
        eg.CDU_CSU_QUANTIDADE,
        TO_CHAR(ea.CDU_CSU_DATA, 'DD/MM/YYYY HH24:MI') AS DATA
    FROM PCE.CSU_EPENTIDADEACTOS ea
    LEFT JOIN PCE.CSU_EPENTIDADEACTOGASTOS eg 
        ON ea.CDU_CSU_ID = eg.CDU_CSU_EPISODIOENTIDADEACTOID
    ORDER BY ea.CDU_CSU_DATA DESC
) t WHERE ROWNUM <= 20;

-- 10. VERIFICAR CAMPO MODULO E ORIGEM
SELECT DISTINCT
    MODULO,
    CDU_CSU_ORIGEM,
    COUNT(*) AS TOTAL
FROM PCE.CSU_EPENTIDADEACTOS
WHERE CDU_CSU_DATA >= SYSDATE - 30
GROUP BY MODULO, CDU_CSU_ORIGEM
ORDER BY TOTAL DESC; 