-- =====================================================
-- QUERIES ESSENCIAIS PARA DESCOBRIR SÉRIES
-- Execute estas queries no Oracle SQL Developer
-- =====================================================

-- QUERY 1: DESCOBRIR SÉRIE E TIPO DOC MAIS USADOS
-- Esta é a query mais importante!
SELECT 
    CDU_CSU_TIPODOCSTK AS TIPO_DOC,
    CDU_CSU_SERIESTK AS SERIE,
    COUNT(*) AS TOTAL_USOS
FROM PCE.CSU_EPENTIDADEACTOS
WHERE CDU_CSU_TIPODOCSTK IS NOT NULL
  AND CDU_CSU_SERIESTK IS NOT NULL
  AND CDU_CSU_DATA >= ADD_MONTHS(SYSDATE, -1) -- Último mês
GROUP BY CDU_CSU_TIPODOCSTK, CDU_CSU_SERIESTK
ORDER BY TOTAL_USOS DESC;

-- QUERY 2: VER EXEMPLOS RECENTES DE SUCESSO
-- Mostra movimentos que funcionaram
SELECT * FROM (
    SELECT 
        CDU_CSU_TIPODOCSTK AS TIPO,
        CDU_CSU_SERIESTK AS SERIE,
        CDU_CSU_FILIALSTK AS FILIAL,
        TO_CHAR(CDU_CSU_DATA, 'DD/MM/YYYY HH24:MI') AS DATA_HORA
    FROM PCE.CSU_EPENTIDADEACTOS
    WHERE CDU_CSU_EXPORTADO = 2 -- Sucesso
      AND CDU_CSU_TIPODOCSTK IS NOT NULL
      AND CDU_CSU_SERIESTK IS NOT NULL
    ORDER BY CDU_CSU_DATA DESC
) t WHERE ROWNUM <= 5;

-- QUERY 3: VERIFICAR MOVIMENTOS DO FA10040790
-- Ver se já houve movimentos deste artigo
SELECT * FROM (
    SELECT 
        ea.CDU_CSU_TIPODOCSTK AS TIPO,
        ea.CDU_CSU_SERIESTK AS SERIE,
        TO_CHAR(ea.CDU_CSU_DATA, 'DD/MM/YYYY') AS DATA,
        ea.CDU_CSU_EXPORTADO AS STATUS,
        eg.CDU_CSU_QUANTIDADE AS QTD
    FROM PCE.CSU_EPENTIDADEACTOS ea
    JOIN PCE.CSU_EPENTIDADEACTOGASTOS eg 
        ON ea.CDU_CSU_ID = eg.CDU_CSU_EPISODIOENTIDADEACTOID
    WHERE eg.CDU_CSU_ARTIGO = 'FA10040790'
    ORDER BY ea.CDU_CSU_DATA DESC
) t WHERE ROWNUM <= 10; 